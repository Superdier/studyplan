<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/tools.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <div class="user-info">
                <img src="https://ui-avatars.com/api/?name=JLPT+Student&background=fdbb2d&color=fff" alt="User">
                <div>Châm nè</div>
            </div>

            <h1><i class="fas fa-book-open"></i> Đầu tư vào bản thân cho tương lai</h1>
            <div class="subtitle">
                Kế hoạch phát triển bản thân trong tiếng Nhật
            </div>
            <div class="date-range">
                <i class="fas fa-calendar-alt"></i> Chặng 1: 10/07/2025 - 06/12/2025 (21 tuần)
            </div>
            <button id="start-study-btn" class="btn btn-primary week-btn" style="margin-top: 15px">
                <i class="fas fa-play-circle"></i> Bắt đầu học
            </button>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="schedule">Lịch học</div>
            <div class="tab" data-tab="stats">Thống kê</div>
            <div class="tab" data-tab="resources">Tài nguyên</div>
            <div class="tab" data-tab="tools" id="tools">Công cụ</div>
        </div>

        <div class="tab-content active" id="schedule-tab">
            <div class="content">
                <div class="card" id="weekly-planner">
                    <h2 class="card-title">
                        <i class="fas fa-calendar-week"></i> Lịch học tuần này
                    </h2>

                    <div class="week-selector">
                        <button class="week-btn" id="prev-week">
                            <i class="fas fa-chevron-left"></i> Tuần trước
                        </button>
                        <div class="current-week" id="current-week-display">
                            Tuần 1: 10/07 - 16/07
                            <span class="phase-badge" style="margin-left: 10px;">Củng cố N2</span>
                        </div>
                        <button class="week-btn" id="current-week-btn">
                            <i class="fas fa-calendar-day"></i> Tuần hiện tại
                        </button>
                        <button class="week-btn" id="next-week">
                            Tuần sau <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <div class="schedule-grid" id="weekly-schedule">
                        <!-- Lịch sẽ được render từ JavaScript -->
                    </div>

                    <div class="completed-count">
                        <i class="fas fa-tasks"></i> Đã hoàn thành:
                        <span id="completed-count">0</span>/<span id="total-tasks">0</span> nhiệm vụ
                    </div>

                    <div class="progress-container">
                        <div class="progress-header">
                            <span>Tiến độ tuần</span>
                            <span id="week-progress">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>

                <div id="study-summary" class="card">
                    <h2 class="card-title">
                        <i class="fas fa-chart-line"></i> Thống kê & Tài nguyên
                    </h2>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-book fa-2x"></i>
                            <div class="stat-value">21</div>
                            <div class="stat-label">Tuần học tập</div>
                        </div>

                        <div class="stat-card">
                            <i class="fas fa-bullseye fa-2x"></i>
                            <div class="stat-value">Kaiwa TỐT</div>
                            <div class="stat-label">Mục tiêu cuối cùng</div>
                        </div>

                        <div class="stat-card">
                            <i class="fas fa-hourglass-half fa-2x"></i>
                            <div class="stat-value">142</div>
                            <div class="stat-label">Ngày còn lại</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="stats-tab">
            <div class="stats-container">
                <div class="stat-section">
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-chart-pie"></i> Tổng quan học tập</h2>
                        <button class="btn btn-primary" id="manage-scores-btn">
                            <i class="fas fa-plus"></i> Quản lý điểm JLPT
                        </button>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <i class="fas fa-clock fa-2x"></i>
                                <div class="stat-value" id="total-hours">0</div>
                                <div class="stat-label">Giờ học tổng</div>
                            </div>

                            <div class="stat-card">
                                <i class="fas fa-tasks fa-2x"></i>
                                <div class="stat-value" id="completion-rate">0%</div>
                                <div class="stat-label">Tỷ lệ hoàn thành</div>
                            </div>

                            <div class="stat-card">
                                <i class="fas fa-fire fa-2x"></i>
                                <div class="stat-value" id="streak-days">0</div>
                                <div class="stat-label">Ngày học liên tiếp</div>
                            </div>

                            <div class="stat-card">
                                <i class="fas fa-check-circle fa-2x"></i>
                                <div class="stat-value" id="lessons-learned">0</div>
                                <div class="stat-label">Bài đã hoàn thành</div>
                            </div>
                        </div>

                        <div class="stat-section full-width">
                            <div class="card">
                                <div class="chart-header">
                                    <h3><i class="fas fa-chart-line"></i> Tiến độ theo tuần</h3>
                                </div>
                                <div class="chart-wrapper large-chart">
                                    <canvas id="progressChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="dual-chart-row">
                            <div class="stat-section half-width">
                                <div class="card">
                                    <div class="chart-header">
                                        <h3><i class="fas fa-star"></i> Đánh giá kỹ năng</h3>
                                    </div>
                                    <div class="chart-wrapper medium-chart">
                                        <canvas id="skillRadarChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-section half-width">
                                <div class="card">
                                    <div class="chart-header">
                                        <h3><i class="fas fa-clock"></i> Phân bố thời gian học</h3>
                                    </div>
                                    <div class="filter-group">
                                        <label for="time-chart-filter">Lọc biểu đồ thời gian:</label>
                                        <select id="time-chart-filter">
                                            <option value="all">Tất cả</option>
                                            <option value="language">Ngôn ngữ</option>
                                            <option value="it">IT</option>
                                            <option value="other">Khác</option>
                                        </select>
                                    </div>
                                    <div class="chart-wrapper medium-chart">
                                        <canvas id="timeDistributionChart"></canvas>
                                    </div>
                                    <div class="task-type-list" id="taskTypeList"></div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-section">
                            <div class="card">
                                <div class="chart-header">
                                    <h3><i class="fas fa-book"></i> Các loại bài tập đã học</h3>
                                </div>
                                <div class="task-category-container" id="taskCategoryContainer"></div>
                            </div>
                        </div>

                        <div class="stat-section">
                            <div class="card">
                                <div class="chart-header">
                                    <h3><i class="fas fa-book"></i> Đánh giá thời gian học hiệu quả</h3>
                                </div>

                                <div class="study-time-comparison">
                                    <div class="time-comparison-card">
                                        <h4><i class="fas fa-calendar-day"></i> Hôm nay</h4>
                                        <div class="time-value" id="daily-study-time-task">0h 0m</div>
                                        <div class="time-source">(Từ completed tasks)</div>
                                        <div class="time-value" id="daily-study-time-session">0h 0m</div>
                                        <div class="time-source">(Từ study sessions)</div>
                                    </div>

                                    <div class="time-comparison-card">
                                        <h4><i class="fas fa-calendar-week"></i> Tuần này</h4>
                                        <div class="time-value" id="weekly-study-time-task">0h</div>
                                        <div class="time-source">(Từ completed tasks)</div>
                                        <div class="time-value" id="weekly-study-time-session">0h</div>
                                        <div class="time-source">(Từ study sessions)</div>
                                    </div>
                                </div>

                                <div class="stat-card">
                                    <i class="fas fa-chart-line fa-2x"></i>
                                    <div class="stat-value" id="max-streak">0</div>
                                    <div class="stat-label">🏆 Kỷ lục streak</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="resources-tab">
            <div class="card">
                <div style="justify-content: space-between; padding-bottom: 15px">
                    <h2 class="card-title">
                        <i class="fas fa-book"></i> Tài nguyên học tập
                    </h2>
                    <button class="btn btn-secondary" id="edit-resources-btn">
                        <i class="fas fa-edit"></i> Chỉnh sửa
                    </button>
                </div>

                <div class="resources" id="resources-display">
                    <!-- Nội dung tài nguyên sẽ được render từ JavaScript -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="tools-tab">
            <div class="card">
                <h2 class="card-title">
                    <i class="fas fa-book-open"></i> Công cụ
                </h2>

                <div class="tools-container">
                    <!-- Writing Practice Tool -->
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-pencil-alt"></i> Luyện viết chữ Hán</h2>
                        <div class="tool-section">
                            <textarea id="writing-text" placeholder="Nhập văn bản tiếng Nhật để luyện viết..."
                                rows="5"></textarea>
                            <div class="tool-controls">
                                <button id="generate-grid" class="btn btn-primary">Tạo lưới luyện viết</button>
                                <button id="export-pdf" class="btn btn-secondary" disabled>Xuất PDF toàn bộ</button>
                                <button id="export-kanji-pdf" class="btn btn-secondary">Xuất PDF theo kanji</button>
                                <button id="clear-writing-text" class="btn btn-secondary">
                                    <i class="fas fa-eraser"></i> Xóa tất cả
                                </button>
                                <div class="font-size-control">
                                    <label>Cỡ chữ:</label>
                                    <input type="range" id="font-size-slider" min="12" max="40" value="20" step="2">
                                    <span id="font-size-value">20px</span>
                                </div>
                            </div>

                            <div id="writing-grid-container" class="hidden">
                                <div id="writing-grid"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Text-to-Speech Tool -->
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-volume-up"></i> Đọc văn bản (Text-to-Speech)</h2>
                        <div class="tool-section">
                            <textarea id="tts-text" placeholder="Nhập văn bản tiếng Nhật để nghe..."
                                rows="5"></textarea>
                            <div class="tool-controls">
                                <div class="voice-control">
                                    <label>Giọng đọc:</label>
                                    <select id="tts-voice">
                                        <option value="">Đang tải giọng...</option>
                                    </select>
                                </div>
                                <div class="speed-control">
                                    <label>Tốc độ:</label>
                                    <input type="range" id="tts-speed" min="0.5" max="2" step="0.1" value="1">
                                    <span id="speed-value">1.0x</span>
                                </div>
                                <div class="tts-buttons">
                                    <button id="play-tts" class="btn btn-primary"><i class="fas fa-play"></i>
                                        Phát</button>
                                    <button id="pause-tts" class="btn btn-secondary" disabled><i
                                            class="fas fa-pause"></i> Tạm dừng</button>
                                    <button id="stop-tts" class="btn btn-secondary" disabled><i class="fas fa-stop"></i>
                                        Dừng</button>
                                    <button id="clear-tts-text" class="btn btn-secondary">
                                        <i class="fas fa-eraser"></i> Xóa tất cả
                                    </button>
                                </div>
                            </div>
                            <div id="tts-highlight-container" class="hidden">
                                <div id="tts-text-display"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Lộ trình học JLPT N1 - Được thiết kế dành riêng cho bạn</p>
            <p>Dựa trên kế hoạch từ 10/7/2025 đến 6/12/2025</p>
        </footer>
    </div>

    <!-- Modal chỉnh sửa nhiệm vụ -->
    <div class="modal" id="edit-day-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-edit-modal">&times;</span>
            <h2><i class="fas fa-edit"></i> Chỉnh sửa nhiệm vụ</h2>
            <div id="modal-date">Thứ 2, 10/07/2025</div>

            <div class="form-group" style="display: none;">
                <label>Thời gian học (phút):</label>
                <input type="number" id="study-duration" min="0" value="60">
            </div>

            <h3>Nhiệm vụ:</h3>
            <div id="tasks-container" class="task-container">
                <!-- Nhiệm vụ sẽ được thêm động ở đây -->
            </div>

            <button id="add-task-btn" class="btn btn-primary">
                <i class="fas fa-plus"></i> Thêm nhiệm vụ
            </button>
            <button id="save-day-btn" class="btn btn-primary" style="margin-top: 15px">
                <i class="fas fa-save"></i> Lưu thay đổi
            </button>
        </div>
    </div>

    <!-- Modal đếm ngược thời gian học -->
    <div class="modal" id="countdown-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">⏳ Bộ đếm ngược</h2>
                <div class="modal-actions">
                    <button id="minimize-timer" class="modal-minimize-btn" title="Thu nhỏ">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button id="close-countdown-modal" class="modal-close-btn" title="Đóng">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>


            <div class="timer-settings">
                <div class="timer-setting">
                    <label>Thời gian học (phút)</label>
                    <input type="number" id="study-minutes" min="1" value="45" />
                </div>
                <div class="timer-setting">
                    <label>Thời gian nghỉ (phút)</label>
                    <input type="number" id="break-minutes" min="1" value="5" />
                </div>
            </div>

            <div class="timer-container">
                <div class="timer-display" id="timer-display">45:00</div>
                <div class="timer-controls">
                    <button class="timer-btn start" id="start-timer">Bắt đầu</button>
                    <button class="timer-btn pause" id="pause-timer" style="display: none">Tạm dừng</button>
                    <button class="timer-btn stop" id="stop-timer" style="display: none">Dừng</button>
                </div>
                <div class="timer-status" id="timer-status">Sẵn sàng bắt đầu học...</div>
            </div>

            <div class="rest-suggestion">
                <p><i class="fas fa-lightbulb"></i> Sau thời gian học, bạn nên:</p>
                <ul style="list-style: none;">
                    <li>Nhắm mắt nghỉ ngơi 1 phút</li>
                    <li>Uống một ly nước</li>
                    <li>Đi bộ vài bước xung quanh</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Modal nghỉ ngơi -->
    <div class="modal" id="break-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-break-modal">&times;</span>
            <h2><i class="fas fa-coffee"></i> Đã đến lúc nghỉ ngơi!</h2>
            <p id="break-message">
                <!-- Nội dung sẽ được cập nhật bằng JavaScript -->
            </p>
            <button class="week-btn" id="start-break-btn">Bắt đầu nghỉ ngơi</button>
        </div>
    </div>

    <!-- Trong phần stats-tab, thêm nút và modal -->
    <div class="tab-content" id="stats-tab">
        <div class="stats-container">
            <div class="stat-section">
                <div class="card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 class="card-title"><i class="fas fa-chart-pie"></i> Tổng quan học tập</h2>
                        <button class="btn btn-primary" id="manage-scores-btn">
                            <i class="fas fa-plus"></i> Quản lý điểm JLPT
                        </button>
                    </div>
                    <!-- ... phần còn lại của card ... -->
                </div>
            </div>
            <!-- ... các phần khác của stats-tab ... -->
        </div>
    </div>

    <!-- Modal quản lý điểm số JLPT -->
    <div class="modal" id="jlpt-scores-modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close-modal" id="close-scores-modal">&times;</span>
            <h2><i class="fas fa-chart-bar"></i> Quản lý điểm số JLPT</h2>

            <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0;">
                <button class="btn btn-primary" id="add-jlpt-score-btn">
                    <i class="fas fa-plus"></i> Thêm điểm số mới
                </button>
                <div class="stats-summary" id="jlpt-stats-summary">
                    <!-- Thống kê tổng quan sẽ được cập nhật ở đây -->
                </div>
            </div>

            <div class="scores-table-container">
                <table class="scores-table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Ngày thi</th>
                            <th>Tiêu đề</th>
                            <th>Link</th>
                            <th>Ngôn ngữ</th>
                            <th>Đọc hiểu</th>
                            <th>Nghe hiểu</th>
                            <th>Tổng điểm</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="jlpt-scores-list">
                        <!-- Danh sách điểm số sẽ được render ở đây -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal thêm/sửa điểm số chi tiết -->
    <div class="modal" id="jlpt-score-detail-modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-modal" id="close-score-detail-modal">&times;</span>
            <h2><i class="fas fa-edit"></i> <span id="jlpt-score-modal-title">Thêm điểm số JLPT</span></h2>

            <div class="form-group">
                <label>Ngày thi:</label>
                <input type="date" id="jlpt-score-date" required>
            </div>

            <div class="form-group">
                <label>Tiêu đề:</label>
                <input type="text" id="jlpt-score-title" placeholder="Ví dụ: Thi thử N1 tháng 7/2025" required>
            </div>

            <div class="form-group">
                <label>Link bài thi (tùy chọn):</label>
                <input type="url" id="jlpt-score-link" placeholder="https://...">
            </div>

            <div class="score-details-section">
                <h3 style="color: #1a2a6c; margin-bottom: 15px;">Điểm chi tiết:</h3>

                <div class="score-input-row">
                    <div class="score-input-group">
                        <label>Kiến thức ngôn ngữ</label>
                        <div class="score-input-with-max">
                            <input type="number" id="jlpt-score-language" min="0" max="60" value="0" required>
                            <span class="score-max">/60</span>
                        </div>
                    </div>

                    <div class="score-input-group">
                        <label>Đọc hiểu</label>
                        <div class="score-input-with-max">
                            <input type="number" id="jlpt-score-reading" min="0" max="60" value="0" required>
                            <span class="score-max">/60</span>
                        </div>
                    </div>

                    <div class="score-input-group">
                        <label>Nghe hiểu</label>
                        <div class="score-input-with-max">
                            <input type="number" id="jlpt-score-listening" min="0" max="60" value="0" required>
                            <span class="score-max">/60</span>
                        </div>
                    </div>
                </div>

                <div class="score-total-display">
                    <div class="total-score">
                        <label>Tổng điểm:</label>
                        <div class="total-score-value">
                            <span id="jlpt-total-score">0</span>
                            <span class="total-max">/180</span>
                        </div>
                    </div>
                    <div class="score-status" id="jlpt-score-status">
                        <!-- Hiển thị trạng thái điểm số -->
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-jlpt-score">Hủy</button>
                <button class="btn btn-primary" id="save-jlpt-score">Lưu điểm số</button>
            </div>
        </div>
    </div>

    <!-- Modal quản lý tài nguyên -->
    <div class="modal" id="manage-resources-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-resources-modal">&times;</span>
            <h2><i class="fas fa-edit"></i> Quản lý tài nguyên học tập</h2>

            <div class="resource-categories">
                <div class="resource-category">
                    <h3><i class="fas fa-book-open"></i> Sách giáo trình</h3>
                    <div id="textbook-resources">
                        <!-- Tài nguyên sẽ được render ở đây -->
                    </div>
                    <button class="btn btn-primary add-resource-btn" data-category="textbook">
                        <i class="fas fa-plus"></i> Thêm sách
                    </button>
                </div>

                <div class="resource-category">
                    <h3><i class="fas fa-headphones"></i> Tài nguyên nghe</h3>
                    <div id="listening-resources">
                        <!-- Tài nguyên sẽ được render ở đây -->
                    </div>
                    <button class="btn btn-primary add-resource-btn" data-category="listening">
                        <i class="fas fa-plus"></i> Thêm tài nguyên nghe
                    </button>
                </div>

                <div class="resource-category">
                    <h3><i class="fas fa-laptop"></i> Website & Ứng dụng</h3>
                    <div id="website-resources">
                        <!-- Tài nguyên sẽ được render ở đây -->
                    </div>
                    <button class="btn btn-primary add-resource-btn" data-category="website">
                        <i class="fas fa-plus"></i> Thêm website
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-primary" id="save-resources">
                    <i class="fas fa-save"></i> Lưu thay đổi
                </button>
            </div>
        </div>
    </div>

    <!-- Floating timer bubble -->
    <div id="floating-timer-bubble" class="floating-timer-bubble minimized">
        <div class="timer-text" id="bubble-timer-display">25:00</div>
        <div class="timer-controls">
            <button id="restore-timer-bubble"><i class="fas fa-expand"></i></button>
            <button id="stop-timer-bubble"><i class="fas fa-stop"></i></button>
        </div>
    </div>

    <script src="js/script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/jspdf-font@1.0.0/Roboto-Regular-normal.js"></script>
    <script src="js/tools.js"></script>
</body>

</html>