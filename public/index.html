<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/tools.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <div class="user-info">
                <img src="https://ui-avatars.com/api/?name=JLPT+Student&background=fdbb2d&color=fff" alt="User">
                <div>Ch√¢m n√®</div>
            </div>

            <h1><i class="fas fa-book-open"></i> ƒê·∫ßu t∆∞ v√†o b·∫£n th√¢n cho t∆∞∆°ng lai</h1>
            <div class="subtitle">
                K·∫ø ho·∫°ch ph√°t tri·ªÉn b·∫£n th√¢n trong ti·∫øng Nh·∫≠t
            </div>
            <div class="date-range" id="current-phase-display">
                <i class="fas fa-calendar-alt"></i> 
                <span id="phase-name-display">Ch·∫∑ng 1</span>
                <span id="phase-completed-badge" class="phase-badge completed-badge" style="display: none;">ƒê√£ ho√†n th√†nh</span>: 
                <span id="phase-dates-display">10/07/2025 - 06/12/2025</span> (<span id="phase-weeks-display">21</span> tu·∫ßn)
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button id="start-study-btn" class="btn btn-primary week-btn">
                    <i class="fas fa-play-circle"></i> B·∫Øt ƒë·∫ßu h·ªçc
                </button>
                <button id="admin-btn" class="btn btn-primary week-btn" style="background: #667eea;">
                    <i class="fas fa-cogs"></i> Qu·∫£n l√Ω
                </button>
                <button id="reminder-settings-btn" class="btn btn-primary week-btn" style="background: #ff9800;">
                    <i class="fas fa-bell"></i> Nh·∫Øc nh·ªü
                </button>
            </div>
            <div>
                <a href="https://review-question-tcham.vercel.app/" target="_blank"
                    style="color: #007bff; text-decoration: none; font-size: 0.9em;">
                    <i class="fas fa-external-link-alt"></i>üî• √în t·∫≠p
                </a>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="schedule">L·ªãch h·ªçc</div>
            <div class="tab" data-tab="stats">Th·ªëng k√™</div>
            <div class="tab" data-tab="resources">T√†i nguy√™n</div>
            <div class="tab" data-tab="tools" id="tools">C√¥ng c·ª•</div>
        </div>

        <div class="tab-content active" id="schedule-tab">
            <div class="content">
                <div class="card" id="weekly-planner">
                    <h2 class="card-title">
                        <i class="fas fa-calendar-week"></i> L·ªãch h·ªçc tu·∫ßn n√†y
                    </h2>

                    <div class="week-selector">
                        <button class="week-btn" id="prev-week">
                            <i class="fas fa-chevron-left"></i> Tu·∫ßn tr∆∞·ªõc
                        </button>
                        <div class="current-week" id="current-week-display">
                            Tu·∫ßn 1: 10/07 - 16/07
                            <span class="phase-badge" style="margin-left: 10px;">C·ªßng c·ªë N2</span>
                        </div>
                        <button class="week-btn" id="current-week-btn">
                            <i class="fas fa-calendar-day"></i> Tu·∫ßn hi·ªán t·∫°i
                        </button>
                        <button class="week-btn" id="next-week">
                            Tu·∫ßn sau <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <div class="schedule-grid" id="weekly-schedule">
                        <!-- L·ªãch s·∫Ω ƒë∆∞·ª£c render t·ª´ JavaScript -->
                    </div>

                    <div class="completed-count">
                        <i class="fas fa-tasks"></i> ƒê√£ ho√†n th√†nh:
                        <span id="completed-count">0</span>/<span id="total-tasks">0</span> nhi·ªám v·ª•
                    </div>

                    <div class="progress-container">
                        <div class="progress-header">
                            <span>Ti·∫øn ƒë·ªô tu·∫ßn</span>
                            <span id="week-progress">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>

                <div id="study-summary" class="card">
                    <h2 class="card-title">
                        <i class="fas fa-chart-line"></i> Th·ªëng k√™ & T√†i nguy√™n
                    </h2>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-book fa-2x"></i>
                            <div class="stat-value" id="summary-weeks">21</div>
                            <div class="stat-label">Tu·∫ßn h·ªçc t·∫≠p</div>
                        </div>

                        <div class="stat-card">
                            <i class="fas fa-bullseye fa-2x"></i>
                            <div class="stat-value" id="summary-goal">...</div>
                            <div class="stat-label">M·ª•c ti√™u cu·ªëi c√πng</div>
                        </div>

                        <div class="stat-card">
                            <i class="fas fa-hourglass-half fa-2x"></i>
                            <div class="stat-value" id="summary-remaining-days">0</div>
                            <div class="stat-label">Ng√†y c√≤n l·∫°i</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="stats-tab">
            <div class="stats-container">
                <div class="stat-section">
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-chart-pie"></i> T·ªïng quan h·ªçc t·∫≠p</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <i class="fas fa-clock fa-2x"></i>
                                <div class="stat-value" id="total-hours">0</div>
                                <div class="stat-label">Gi·ªù h·ªçc t·ªïng</div>
                            </div>

                            <div class="stat-card">
                                <i class="fas fa-tasks fa-2x"></i>
                                <div class="stat-value" id="completion-rate">0%</div>
                                <div class="stat-label">T·ª∑ l·ªá ho√†n th√†nh</div>
                            </div>

                            <div class="stat-card">
                                <i class="fas fa-fire fa-2x"></i>
                                <div class="stat-value" id="streak-days">0</div>
                                <div class="stat-label">Ng√†y h·ªçc li√™n ti·∫øp</div>
                            </div>

                            <div class="stat-card">
                                <i class="fas fa-check-circle fa-2x"></i>
                                <div class="stat-value" id="lessons-learned">0</div>
                                <div class="stat-label">B√†i ƒë√£ ho√†n th√†nh</div>
                            </div>
                        </div>

                        <div class="stat-section full-width">
                            <div class="card">
                                <div class="chart-header">
                                    <h3><i class="fas fa-chart-line"></i> Ti·∫øn ƒë·ªô theo tu·∫ßn</h3>
                                </div>
                                <div class="chart-wrapper large-chart">
                                    <canvas id="progressChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="dual-chart-row">
                            <div class="stat-section half-width">
                                <div class="card">
                                    <div class="chart-header">
                                        <h3><i class="fas fa-star"></i> ƒê√°nh gi√° k·ªπ nƒÉng</h3>
                                    </div>
                                    <div>
                                        <div class="skill-chart-controls">
                                            <div class="skill-filter-group">
                                                <label for="skill-chart-filter">Hi·ªÉn th·ªã:</label>
                                                <select id="skill-chart-filter">
                                                    <option value="all">T·ªïng h·ª£p</option>
                                                    <option value="jlpt">ƒêi·ªÉm JLPT</option>
                                                    <option value="individual">Test ri√™ng</option>
                                                </select>
                                            </div>
                                            <div class="skill-filter-group">
                                                <button class="btn btn-primary btn-small"
                                                    id="manage-skill-assessments-btn">
                                                    <i class="fas fa-plus"></i> Qu·∫£n l√Ω Test ri√™ng
                                                </button>
                                                <button class="btn btn-primary btn-small" id="manage-scores-btn">
                                                    <i class="fas fa-plus"></i> Qu·∫£n l√Ω ƒëi·ªÉm JLPT
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-wrapper medium-chart">
                                        <canvas id="skillRadarChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-section half-width">
                                <div class="card">
                                    <div class="chart-header">
                                        <h3><i class="fas fa-clock"></i> Ph√¢n b·ªë th·ªùi gian h·ªçc</h3>
                                    </div>
                                    <div class="filter-group">
                                        <label for="time-chart-filter">L·ªçc bi·ªÉu ƒë·ªì th·ªùi gian:</label>
                                        <select id="time-chart-filter">
                                            <option value="all">T·∫•t c·∫£</option>
                                            <option value="language">Ng√¥n ng·ªØ</option>
                                            <option value="it">IT</option>
                                            <option value="other">Kh√°c</option>
                                        </select>
                                    </div>
                                    <div class="chart-wrapper medium-chart">
                                        <canvas id="timeDistributionChart"></canvas>
                                    </div>
                                    <div class="task-type-list" id="taskTypeList"></div>
                                </div>
                            </div>
                        </div>


                        <div class="stat-section full-width progress-heatmap-section">
                            <div class="card">
                                <div class="chart-header">
                                    <h3><i class="fas fa-fire"></i> B·∫£n ƒë·ªì nhi·ªát Ti·∫øn b·ªô JLPT</h3>
                                    <p style="margin: 0; font-size: 0.9em; color: #666;">
                                        Theo d√µi s·ª± thay ƒë·ªïi ƒëi·ªÉm s·ªë t·ª´ng k·ªπ nƒÉng qua c√°c l·∫ßn thi
                                    </p>
                                </div>
                                <div id="progress-heatmap-container">
                                    <!-- Progress Heatmap s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y b·ªüi JavaScript -->
                                </div>

                                <!-- Legend m·∫∑c ƒë·ªãnh -->
                                <div class="heatmap-legend">
                                    <h4><i class="fas fa-palette"></i> Thang m√†u ƒëi·ªÉm s·ªë thay ƒë·ªïi</h4>
                                    <div class="legend-scale">
                                        <div class="legend-item">
                                            <div class="legend-color cell-positive-5"></div>
                                            <span>Ti·∫øn b·ªô m·∫°nh (+10‚Üë)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color cell-positive-3"></div>
                                            <span>Ti·∫øn b·ªô (+5 ƒë·∫øn +9)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color cell-positive-1"></div>
                                            <span>Ti·∫øn b·ªô nh·∫π (+1 ƒë·∫øn +4)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color cell-neutral"></div>
                                            <span>Kh√¥ng ƒë·ªïi (0)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color cell-negative-1"></div>
                                            <span>T·ª•t nh·∫π (-1 ƒë·∫øn -4)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color cell-negative-3"></div>
                                            <span>T·ª•t (-5 ƒë·∫øn -9)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color cell-negative-5"></div>
                                            <span>T·ª•t m·∫°nh (-10‚Üì)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color cell-no-data"></div>
                                            <span>Ch∆∞a c√≥ d·ªØ li·ªáu</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-section">
                            <div class="card">
                                <div class="chart-header">
                                    <h3><i class="fas fa-book"></i> C√°c lo·∫°i b√†i t·∫≠p ƒë√£ h·ªçc</h3>
                                </div>
                                <div class="task-category-container" id="taskCategoryContainer"></div>
                            </div>
                        </div>

                        <div class="stat-section">
                            <div class="card">
                                <div class="chart-header">
                                    <h3><i class="fas fa-book"></i> ƒê√°nh gi√° th·ªùi gian h·ªçc hi·ªáu qu·∫£</h3>
                                </div>

                                <div class="study-time-comparison">
                                    <div class="time-comparison-card">
                                        <h4><i class="fas fa-calendar-day"></i> H√¥m nay</h4>
                                        <div class="time-value" id="daily-study-time-task">0h 0m</div>
                                        <div class="time-source">(T·ª´ completed tasks)</div>
                                        <div class="time-value" id="daily-study-time-session">0h 0m</div>
                                        <div class="time-source">(T·ª´ study sessions)</div>
                                    </div>

                                    <div class="time-comparison-card">
                                        <h4><i class="fas fa-calendar-week"></i> Tu·∫ßn n√†y</h4>
                                        <div class="time-value" id="weekly-study-time-task">0h</div>
                                        <div class="time-source">(T·ª´ completed tasks)</div>
                                        <div class="time-value" id="weekly-study-time-session">0h</div>
                                        <div class="time-source">(T·ª´ study sessions)</div>
                                    </div>
                                </div>

                                <div class="stat-card">
                                    <i class="fas fa-chart-line fa-2x"></i>
                                    <div class="stat-value" id="max-streak">0</div>
                                    <div class="stat-label">üèÜ K·ª∑ l·ª•c streak</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="resources-tab">
            <div class="card">
                <div style="justify-content: space-between; padding-bottom: 15px">
                    <h2 class="card-title">
                        <i class="fas fa-book"></i> T√†i nguy√™n h·ªçc t·∫≠p
                    </h2>
                    <button class="btn btn-secondary" id="edit-resources-btn">
                        <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
                    </button>
                </div>

                <div class="resources" id="resources-display">
                    <!-- N·ªôi dung t√†i nguy√™n s·∫Ω ƒë∆∞·ª£c render t·ª´ JavaScript -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="tools-tab">
            <div class="card">
                <h2 class="card-title">
                    <i class="fas fa-book-open"></i> C√¥ng c·ª•
                </h2>

                <div class="tools-container">
                    <!-- Writing Practice Tool -->
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-pencil-alt"></i> Luy·ªán vi·∫øt ch·ªØ H√°n</h2>
                        <div class="word-split-control">
                            <label for="custom-delimiters">D·∫•u ph√¢n c√°ch t·ª´:</label>
                            <input type="text" id="custom-delimiters" value=" „ÄÄ\n„ÄÅ,;:"
                                placeholder="Nh·∫≠p d·∫•u ph√¢n c√°ch (v√≠ d·ª•: „ÄÄ ,;)"
                                style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 200px;">
                            <button type="button" id="preview-split-btn" class="btn btn-secondary"
                                style="margin-left: 10px;">
                                <i class="fas fa-eye"></i> Xem th·ª≠
                            </button>
                        </div>

                        <!-- Th√™m ph·∫ßn preview (t√πy ch·ªçn) -->
                        <div id="word-split-preview"
                            style="margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px; font-size: 14px; display: none;">
                        </div>
                        <div class="tool-section">
                            <textarea id="writing-text" placeholder="Nh·∫≠p vƒÉn b·∫£n ti·∫øng Nh·∫≠t ƒë·ªÉ luy·ªán vi·∫øt..."
                                rows="5"></textarea>
                            <div class="tool-controls">
                                <button id="generate-grid" class="btn btn-primary">T·∫°o l∆∞·ªõi luy·ªán vi·∫øt</button>
                                <button id="export-pdf" class="btn btn-secondary" disabled>Xu·∫•t PDF to√†n b·ªô</button>
                                <button id="export-kanji-pdf" class="btn btn-secondary">Xu·∫•t PDF theo kanji</button>
                                <button id="clear-writing-text" class="btn btn-secondary">
                                    <i class="fas fa-eraser"></i> X√≥a t·∫•t c·∫£
                                </button>
                                <div class="font-size-control">
                                    <label>C·ª° ch·ªØ:</label>
                                    <input type="range" id="font-size-slider" min="12" max="40" value="20" step="2">
                                    <span id="font-size-value">20px</span>
                                </div>
                            </div>

                            <div id="writing-grid-container" class="hidden">
                                <div id="writing-grid"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Text-to-Speech Tool -->
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-volume-up"></i> ƒê·ªçc vƒÉn b·∫£n (Text-to-Speech)</h2>
                        <div class="tool-section">
                            <textarea id="tts-text" placeholder="Nh·∫≠p vƒÉn b·∫£n ti·∫øng Nh·∫≠t ƒë·ªÉ nghe..."
                                rows="5"></textarea>
                            <div class="tool-controls">
                                <div class="voice-control">
                                    <label>Gi·ªçng ƒë·ªçc:</label>
                                    <select id="tts-voice">
                                        <option value="">ƒêang t·∫£i gi·ªçng...</option>
                                    </select>
                                </div>
                                <div class="speed-control">
                                    <label>T·ªëc ƒë·ªô:</label>
                                    <input type="range" id="tts-speed" min="0.5" max="2" step="0.1" value="1">
                                    <span id="speed-value">1.0x</span>
                                </div>
                                <div class="tts-buttons">
                                    <button id="play-tts" class="btn btn-primary"><i class="fas fa-play"></i>
                                        Ph√°t</button>
                                    <button id="pause-tts" class="btn btn-secondary" disabled><i
                                            class="fas fa-pause"></i> T·∫°m d·ª´ng</button>
                                    <button id="stop-tts" class="btn btn-secondary" disabled><i class="fas fa-stop"></i>
                                        D·ª´ng</button>
                                    <button id="clear-tts-text" class="btn btn-secondary">
                                        <i class="fas fa-eraser"></i> X√≥a t·∫•t c·∫£
                                    </button>
                                </div>
                            </div>
                            <div id="tts-highlight-container" class="hidden">
                                <div id="tts-text-display"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>L·ªô tr√¨nh h·ªçc JLPT N1 - ƒê∆∞·ª£c thi·∫øt k·∫ø d√†nh ri√™ng cho b·∫°n</p>
            <p>D·ª±a tr√™n k·∫ø ho·∫°ch t·ª´ 10/7/2025 ƒë·∫øn 6/12/2025</p>
        </footer>
    </div>

    <!-- Modal ch·ªânh s·ª≠a nhi·ªám v·ª• -->
    <div class="modal" id="edit-day-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Ch·ªânh s·ª≠a nhi·ªám v·ª•</h2>
                <span class="close-modal" id="close-edit-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modal-date">Th·ª© 2, 10/07/2025</div>
                <div class="form-group" style="display: none;">
                    <label>Th·ªùi gian h·ªçc (ph√∫t):</label>
                    <input type="number" id="study-duration" min="0" value="60">
                </div>
                <h3>Nhi·ªám v·ª•:</h3>
                <div id="tasks-container" class="task-container">
                    <!-- Nhi·ªám v·ª• s·∫Ω ƒë∆∞·ª£c th√™m ƒë·ªông ·ªü ƒë√¢y -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="add-task-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Th√™m nhi·ªám v·ª•
                </button>
                <button id="save-day-btn" class="btn btn-primary">
                    <i class="fas fa-save"></i> L∆∞u thay ƒë·ªïi
                </button>
            </div>
        </div>
    </div>

    <!-- Modal countdown -->
    <div class="modal" id="countdown-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚è≥ B·ªô ƒë·∫øm ng∆∞·ª£c</h2>
                <div class="modal-actions">
                    <button id="minimize-timer" class="modal-minimize-btn" title="Thu nh·ªè">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button id="close-countdown-modal" class="modal-close-btn" title="ƒê√≥ng">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Audio status indicator -->
                <div class="audio-status-indicator" id="audio-status-indicator"></div>
            </div>

            <div class="modal-body">
                <div class="timer-settings">
                    <div class="timer-setting">
                        <label>Th·ªùi gian h·ªçc (ph√∫t)</label>
                        <input type="number" id="study-minutes" min="1" value="45" />
                    </div>
                    <div class="timer-setting">
                        <label>Th·ªùi gian ngh·ªâ (ph√∫t)</label>
                        <input type="number" id="break-minutes" min="1" value="5" />
                    </div>
                </div>

                <div class="timer-container">
                    <div class="timer-display" id="timer-display">45:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn start" id="start-timer">B·∫Øt ƒë·∫ßu</button>
                        <button class="timer-btn pause" id="pause-timer" style="display: none">T·∫°m d·ª´ng</button>
                        <button class="timer-btn stop" id="stop-timer" style="display: none">D·ª´ng</button>
                    </div>
                    <div class="timer-status" id="timer-status">S·∫µn s√†ng b·∫Øt ƒë·∫ßu h·ªçc...</div>
                </div>

                <!-- Audio Controls s·∫Ω ƒë∆∞·ª£c th√™m ƒë·ªông b·ªüi JavaScript -->

                <div class="rest-suggestion">
                    <p><i class="fas fa-lightbulb"></i> Sau th·ªùi gian h·ªçc, b·∫°n n√™n:</p>
                    <ul style="list-style: none;">
                        <li>Nh·∫Øm m·∫Øt ngh·ªâ ng∆°i 1 ph√∫t</li>
                        <li>U·ªëng m·ªôt ly n∆∞·ªõc</li>
                        <li>ƒêi b·ªô v√†i b∆∞·ªõc xung quanh</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Break modal -->
    <div class="modal" id="break-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-coffee"></i> ƒê√£ ƒë·∫øn l√∫c ngh·ªâ ng∆°i!</h2>
                <span class="close-modal" id="close-break-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p id="break-message">
                    <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JavaScript -->
                </p>
                <!-- Audio notification indicator -->
                <div style="text-align: center; margin: 15px 0;">
                    <div class="audio-playing-indicator" id="break-audio-indicator" style="display: none;">
                        <i class="fas fa-volume-up"></i>
                        <span>ƒêang ph√°t √¢m thanh th√¥ng b√°o...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <button class="btn btn-primary" id="start-break-btn">
                    <i class="fas fa-play"></i> B·∫Øt ƒë·∫ßu ngh·ªâ ng∆°i
                </button>
                <button class="btn btn-secondary" onclick="hideBreakModal()" style="margin-left: 10px;">
                    <i class="fas fa-times"></i> B·ªè qua ngh·ªâ ng∆°i
                </button>
            </div>
        </div>
    </div>

    <!-- C·∫≠p nh·∫≠t floating timer bubble -->
    <div id="floating-timer-bubble" class="floating-timer-bubble minimized">
        <div class="timer-text" id="bubble-timer-display">25:00</div>
        <div class="timer-controls">
            <button id="restore-timer-bubble" title="M·ªü r·ªông"><i class="fas fa-expand"></i></button>
            <button id="stop-timer-bubble" title="D·ª´ng timer"><i class="fas fa-stop"></i></button>
        </div>
        <!-- Audio indicator cho floating timer -->
        <div class="audio-status-indicator" id="floating-audio-indicator"></div>
    </div>

    <!-- Trong ph·∫ßn stats-tab, th√™m n√∫t v√† modal -->
    <div class="tab-content" id="stats-tab">
        <div class="stats-container">
            <div class="stat-section">
                <div class="card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 class="card-title"><i class="fas fa-chart-pie"></i> T·ªïng quan h·ªçc t·∫≠p</h2>
                        <button class="btn btn-primary" id="manage-scores-btn">
                            <i class="fas fa-plus"></i> Qu·∫£n l√Ω ƒëi·ªÉm JLPT
                        </button>
                    </div>
                    <!-- ... ph·∫ßn c√≤n l·∫°i c·ªßa card ... -->
                </div>
            </div>
            <!-- ... c√°c ph·∫ßn kh√°c c·ªßa stats-tab ... -->
        </div>
    </div>

    <!-- Modal qu·∫£n l√Ω ƒëi·ªÉm s·ªë JLPT -->
    <div class="modal" id="jlpt-scores-modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2><i class="fas fa-chart-bar"></i> Qu·∫£n l√Ω ƒëi·ªÉm s·ªë JLPT</h2>
                <span class="close-modal" id="close-scores-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin: 0 0 20px 0;">
                    <button class="btn btn-primary" id="add-jlpt-score-btn">
                        <i class="fas fa-plus"></i> Th√™m ƒëi·ªÉm s·ªë m·ªõi
                    </button>
                    <div class="stats-summary" id="jlpt-stats-summary">
                        <!-- Th·ªëng k√™ t·ªïng quan s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t ·ªü ƒë√¢y -->
                    </div>
                </div>
                <div class="scores-table-container">
                    <table class="scores-table">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Ng√†y thi</th>
                                <th>Ti√™u ƒë·ªÅ</th>
                                <th>Link</th>
                                <th>Ng√¥n ng·ªØ</th>
                                <th>ƒê·ªçc hi·ªÉu</th>
                                <th>Nghe hi·ªÉu</th>
                                <th>T·ªïng ƒëi·ªÉm</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="jlpt-scores-list">
                            <!-- Danh s√°ch ƒëi·ªÉm s·ªë s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal qu·∫£n l√Ω skill assessments -->
    <div class="modal" id="skill-assessments-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-chart-bar"></i> Qu·∫£n l√Ω Test k·ªπ nƒÉng ri√™ng</h2>
                <span class="close-modal" id="close-skill-assessments-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin: 0 0 20px 0;">
                    <button class="btn btn-primary" id="add-skill-assessment-btn">
                        <i class="fas fa-plus"></i> Th√™m test m·ªõi
                    </button>
                    <div class="skill-assessment-summary" id="skill-assessments-summary">
                        <!-- Th·ªëng k√™ t√≥m t·∫Øt s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t ·ªü ƒë√¢y -->
                    </div>
                </div>
                <div class="skill-assessments-table-container">
                    <table class="skill-assessments-table">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Ng√†y test</th>
                                <th>K·ªπ nƒÉng</th>
                                <th>Ti√™u ƒë·ªÅ</th>
                                <th>Link</th>
                                <th>ƒêi·ªÉm</th>
                                <th>M·ª©c ƒë·ªô</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="skill-assessments-list">
                            <!-- Danh s√°ch skill assessments s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        </tbody>
                    </table>
                </div>
                <div class="skill-chart-legend">
                    <div class="skill-legend-title">Thang ƒë√°nh gi√°:</div>
                    <div class="skill-legend-items">
                        <div class="skill-legend-item">
                            <div class="skill-level-badge level-excellent">Xu·∫•t s·∫Øc</div>
                            <span>90-100%</span>
                        </div>
                        <div class="skill-legend-item">
                            <div class="skill-level-badge level-good">Gi·ªèi</div>
                            <span>80-89%</span>
                        </div>
                        <div class="skill-legend-item">
                            <div class="skill-level-badge level-fair">Kh√°</div>
                            <span>70-79%</span>
                        </div>
                        <div class="skill-legend-item">
                            <div class="skill-level-badge level-average">Trung b√¨nh</div>
                            <span>60-69%</span>
                        </div>
                        <div class="skill-legend-item">
                            <div class="skill-level-badge level-poor">Y·∫øu</div>
                            <span>50-59%</span>
                        </div>
                        <div class="skill-legend-item">
                            <div class="skill-level-badge level-bad">K√©m</div>
                            <span>
                                < 50%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal th√™m/s·ª≠a skill assessment chi ti·∫øt -->
    <div class="modal" id="skill-assessment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> <span id="skill-assessment-modal-title">Th√™m test k·ªπ nƒÉng</span></h2>
                <span class="close-modal" id="close-skill-assessment-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="skill-assessment-form">
                    <div class="skill-form-row">
                        <div class="skill-form-group">
                            <label>Ng√†y test:</label>
                            <input type="date" id="skill-assessment-date" required>
                        </div>
                        <div class="skill-form-group">
                            <label>Lo·∫°i k·ªπ nƒÉng:</label>
                            <select id="skill-assessment-type" required>
                                <option value="kanji">üà¥ Test Kanji</option>
                                <option value="vocabulary">üìö Test T·ª´ v·ª±ng</option>
                                <option value="grammar">‚öôÔ∏è Test Ng·ªØ ph√°p</option>
                                <option value="reading">üìñ Test ƒê·ªçc hi·ªÉu</option>
                                <option value="listening">üéß Test Nghe hi·ªÉu</option>
                                <option value="speaking">üé§ Test N√≥i</option>
                                <option value="writing">‚úçÔ∏è Test Vi·∫øt</option>
                            </select>
                        </div>
                    </div>
                    <div class="skill-form-group full-width">
                        <label>Ti√™u ƒë·ªÅ b√†i test:</label>
                        <input type="text" id="skill-assessment-title" placeholder="V√≠ d·ª•: Test Kanji N2 - Chapter 5"
                            required>
                    </div>
                    <div class="skill-form-group full-width">
                        <label>Link b√†i test (t√πy ch·ªçn):</label>
                        <input type="url" id="skill-assessment-link" placeholder="https://...">
                    </div>
                    <div class="skill-form-row">
                        <div class="skill-form-group">
                            <label>ƒêi·ªÉm s·ªë ƒë·∫°t ƒë∆∞·ª£c:</label>
                            <div class="score-input-container">
                                <input type="number" id="skill-assessment-score" min="0" max="100" required>
                                <div class="score-max-display">
                                    / <span id="skill-score-max">100</span>
                                </div>
                            </div>
                        </div>
                        <div class="skill-form-group">
                            <label>M·ª©c ƒë·ªô ƒë√°nh gi√°:</label>
                            <div id="skill-level-preview" class="skill-level-badge level-average">
                                Trung b√¨nh
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-skill-assessment">H·ªßy</button>
                <button class="btn btn-primary" id="save-skill-assessment">L∆∞u ƒë√°nh gi√°</button>
            </div>
        </div>
    </div>

    <!-- Modal th√™m/s·ª≠a ƒëi·ªÉm s·ªë chi ti·∫øt -->
    <div class="modal" id="jlpt-score-detail-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> <span id="jlpt-score-modal-title">Th√™m ƒëi·ªÉm s·ªë JLPT</span></h2>
                <span class="close-modal" id="close-score-detail-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Ng√†y thi:</label>
                    <input type="date" id="jlpt-score-date" required>
                </div>
                <div class="form-group">
                    <label>Ti√™u ƒë·ªÅ:</label>
                    <input type="text" id="jlpt-score-title" placeholder="V√≠ d·ª•: Thi th·ª≠ N1 th√°ng 7/2025" required>
                </div>
                <div class="form-group">
                    <label>Link b√†i thi (t√πy ch·ªçn):</label>
                    <input type="url" id="jlpt-score-link" placeholder="https://...">
                </div>
                <div class="score-details-section">
                    <h3 style="color: #1a2a6c; margin-bottom: 15px;">ƒêi·ªÉm chi ti·∫øt:</h3>
                    <div class="score-input-row">
                        <div class="score-input-group">
                            <label>Ki·∫øn th·ª©c ng√¥n ng·ªØ</label>
                            <div class="score-input-with-max">
                                <input type="number" id="jlpt-score-language" min="0" max="60" value="0" required>
                                <span class="score-max">/60</span>
                            </div>
                        </div>
                        <div class="score-input-group">
                            <label>ƒê·ªçc hi·ªÉu</label>
                            <div class="score-input-with-max">
                                <input type="number" id="jlpt-score-reading" min="0" max="60" value="0" required>
                                <span class="score-max">/60</span>
                            </div>
                        </div>
                        <div class="score-input-group">
                            <label>Nghe hi·ªÉu</label>
                            <div class="score-input-with-max">
                                <input type="number" id="jlpt-score-listening" min="0" max="60" value="0" required>
                                <span class="score-max">/60</span>
                            </div>
                        </div>
                    </div>
                    <div class="score-total-display">
                        <div class="total-score">
                            <label>T·ªïng ƒëi·ªÉm:</label>
                            <div class="total-score-value">
                                <span id="jlpt-total-score">0</span>
                                <span class="total-max">/180</span>
                            </div>
                        </div>
                        <div class="score-status" id="jlpt-score-status">
                            <!-- Hi·ªÉn th·ªã tr·∫°ng th√°i ƒëi·ªÉm s·ªë -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-jlpt-score">H·ªßy</button>
                <button class="btn btn-primary" id="save-jlpt-score">L∆∞u ƒëi·ªÉm s·ªë</button>
            </div>
        </div>
    </div>

    <!-- Modal qu·∫£n l√Ω t√†i nguy√™n -->
    <div class="modal" id="manage-resources-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Qu·∫£n l√Ω t√†i nguy√™n h·ªçc t·∫≠p</h2>
                <span class="close-modal" id="close-resources-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="resource-categories">
                    <div class="resource-category">
                        <h3><i class="fas fa-book-open"></i> S√°ch gi√°o tr√¨nh</h3>
                        <div id="textbook-resources">
                            <!-- T√†i nguy√™n s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        </div>
                        <button class="btn btn-primary add-resource-btn" data-category="textbook">
                            <i class="fas fa-plus"></i> Th√™m s√°ch
                        </button>
                    </div>
                    <div class="resource-category">
                        <h3><i class="fas fa-headphones"></i> T√†i nguy√™n nghe</h3>
                        <div id="listening-resources">
                            <!-- T√†i nguy√™n s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        </div>
                        <button class="btn btn-primary add-resource-btn" data-category="listening">
                            <i class="fas fa-plus"></i> Th√™m t√†i nguy√™n nghe
                        </button>
                    </div>
                    <div class="resource-category">
                        <h3><i class="fas fa-laptop"></i> Website & ·ª®ng d·ª•ng</h3>
                        <div id="website-resources">
                            <!-- T√†i nguy√™n s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        </div>
                        <button class="btn btn-primary add-resource-btn" data-category="website">
                            <i class="fas fa-plus"></i> Th√™m website
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="save-resources">
                    <i class="fas fa-save"></i> L∆∞u thay ƒë·ªïi
                </button>
            </div>
        </div>
    </div>

    <!-- Modal C√†i ƒë·∫∑t Nh·∫Øc nh·ªü Email -->
    <div class="modal" id="reminder-settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-envelope"></i> C√†i ƒë·∫∑t Nh·∫Øc nh·ªü Email</h2>
                <span class="close-modal" id="close-reminder-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="audio-toggle">
                        <input type="checkbox" id="reminder-enabled">
                        <span>B·∫≠t t√≠nh nƒÉng nh·∫Øc nh·ªü qua Email</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>Email nh·∫≠n th√¥ng b√°o:</label>
                    <input type="email" id="reminder-email" placeholder="nhap_email_cua_ban@example.com">
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian nh·∫Øc (c√°ch nhau b·ªüi d·∫•u ph·∫©y):</label>
                    <input type="text" id="reminder-times" placeholder="08:00, 14:00, 20:00">
                    <small style="color: #666;">ƒê·ªãnh d·∫°ng 24h (HH:MM). V√≠ d·ª•: 07:30, 21:00</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="save-reminder-settings">L∆∞u c√†i ƒë·∫∑t</button>
                <button class="btn btn-secondary" id="test-email-btn">G·ª≠i th·ª≠ ngay</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="login-modal" style="display: flex; z-index: 20000;">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div class="modal-body">
                <h2><i class="fas fa-lock"></i> Y√™u c·∫ßu x√°c th·ª±c</h2>
                <p>Vui l√≤ng nh·∫≠p m√£ PIN ƒë·ªÉ truy c·∫≠p v·ªõi t∆∞ c√°ch qu·∫£n tr·ªã vi√™n ho·∫∑c ti·∫øp t·ª•c v·ªõi t∆∞ c√°ch kh√°ch.</p>
                <form id="login-form" style="margin-top: 20px;">
                    <div class="form-group" style="text-align: left; position: relative;">
                        <label for="pin-input" style="font-weight: bold;">M√£ PIN:</label>
                        <div class="pin-input-wrapper">
                            <input type="password" id="pin-input" class="pin-input" autocomplete="off" autofocus>
                            <i class="fas fa-eye" id="toggle-pin-visibility"></i>
                        </div>
                    </div>
                    <div id="login-error" class="login-error-message" style="display: none;">M√£ PIN kh√¥ng ch√≠nh x√°c.</div>
                    <div class="login-actions">
                        <button type="button" id="guest-login-btn" class="btn btn-secondary">
                            <i class="fas fa-user-secret"></i> V√†o v·ªõi t∆∞ c√°ch Kh√°ch
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> X√°c nh·∫≠n
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Th√™m script ƒë·ªÉ update skill level preview khi thay ƒë·ªïi ƒëi·ªÉm
        document.addEventListener('DOMContentLoaded', function () {
            const scoreInput = document.getElementById('skill-assessment-score');
            const skillTypeSelect = document.getElementById('skill-assessment-type');
            const levelPreview = document.getElementById('skill-level-preview');

            function updateSkillLevelPreview() {
                const score = parseInt(scoreInput?.value) || 0;
                const skillType = skillTypeSelect?.value || 'kanji';
                const maxScore = skillTypes[skillType]?.maxScore || 100;
                const percentage = (score / maxScore) * 100;

                let level = 'K√©m';
                let className = 'level-bad';

                if (percentage >= 90) {
                    level = 'Xu·∫•t s·∫Øc';
                    className = 'level-excellent';
                } else if (percentage >= 80) {
                    level = 'Gi·ªèi';
                    className = 'level-good';
                } else if (percentage >= 70) {
                    level = 'Kh√°';
                    className = 'level-fair';
                } else if (percentage >= 60) {
                    level = 'Trung b√¨nh';
                    className = 'level-average';
                } else if (percentage >= 50) {
                    level = 'Y·∫øu';
                    className = 'level-poor';
                }

                if (levelPreview) {
                    levelPreview.textContent = level;
                    levelPreview.className = `skill-level-badge ${className}`;
                }
            }

            scoreInput?.addEventListener('input', updateSkillLevelPreview);
            skillTypeSelect?.addEventListener('change', updateSkillLevelPreview);
        });
    </script>

    <script src="js/script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/jspdf-font@1.0.0/Roboto-Regular-normal.js"></script>
    <script src="js/tools.js"></script>
</body>

</html>